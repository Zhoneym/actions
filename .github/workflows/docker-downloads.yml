name: Build GCC 9 (up to make)

on:
  workflow_dispatch:

jobs:
  build-gcc:
    runs-on: ubuntu-latest

    steps:
    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y build-essential wget curl libgmp-dev libmpfr-dev libmpc-dev libisl-dev flex bison texinfo

    - name: Download GCC 9 source
      run: |
        mkdir -p $HOME/gcc-build
        cd $HOME/gcc-build
        wget https://ftp.gnu.org/gnu/gcc/gcc-9.5.0/gcc-9.5.0.tar.xz
        tar -xf gcc-9.5.0.tar.xz

    - name: Configure GCC (static build)
      run: |
        cd $HOME/gcc-build
        mkdir gcc-9.5.0-build
        cd gcc-9.5.0-build

        ../gcc-9.5.0/configure \
          --prefix=/usr/local/gcc-9 \
          --disable-multilib \
          --enable-languages=c,c++ \
          --disable-bootstrap \
          --disable-shared \
          --enable-static \
          --disable-nls

    - name: Build GCC (stop at make)
      run: |
        cd $HOME/gcc-build/gcc-9.5.0-build
        make -j$(nproc)

    - name: Compress build directory into tar.gz
      run: |
        cd $HOME/
        tar -czf gcc-9.5.0.tar.gz $HOME/gcc-build

    - name: Upload GCC build tarball
      uses: actions/upload-artifact@v4
      with:
        name: gcc-9.5.0-build-tarball
        path: /home/runner/gcc-9.5.0.tar.gz
