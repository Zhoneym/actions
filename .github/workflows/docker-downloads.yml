name: Build Ubuntu 18.04 rootfs with GCC

on:
  workflow_dispatch:

jobs:
  build-rootfs:
    runs-on: ubuntu-latest

    steps:
    - name: Install debootstrap
      run: sudo apt-get update && sudo apt-get install -y debootstrap

    - name: Create rootfs directory
      run: mkdir rootfs

    - name: Bootstrap minimal Ubuntu bionic rootfs
      run: |
        sudo debootstrap --variant=minbase bionic rootfs http://archive.ubuntu.com/ubuntu/

    - name: Install gcc and g++ in rootfs
      run: |
        sudo chroot rootfs /bin/bash -c "apt-get update"
        sudo chroot rootfs /bin/bash -c "DEBIAN_FRONTEND=noninteractive apt-get install -y gcc g++"

    - name: Clean apt cache in rootfs
      run: sudo chroot rootfs /bin/bash -c "apt-get clean"

    - name: Pack rootfs
      run: tar czf ubuntu-bionic-gcc-rootfs.tar.gz -C rootfs .

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: ubuntu-bionic-gcc-rootfs
        path: ubuntu-bionic-gcc-rootfs.tar.gz
