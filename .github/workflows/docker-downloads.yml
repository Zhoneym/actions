name: Convert Arch pkg.tar.zst to deb

on:
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest
    name: Convert zotero pkg to deb

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y zstd libarchive-tools dpkg-dev

      - name: Download pkg.tar.zst
        run: |
          wget https://repo.archlinuxcn.org/aarch64/zotero-7.0.15-3-aarch64.pkg.tar.zst -O zotero.pkg.tar.zst

      - name: Extract pkg.tar.zst
        run: |
          mkdir extracted
          bsdtar -xvf zotero.pkg.tar.zst -C extracted

      - name: Create DEBIAN control file
        run: |
          mkdir -p deb/DEBIAN
          mkdir -p deb/usr
          cp -r extracted/usr/* deb/usr/

          cat <<EOF > deb/DEBIAN/control
          Package: zotero
          Version: 7.0.15-3
          Architecture: arm64
          Maintainer: Your Name <you@example.com>
          Description: Zotero (converted from Arch pkg)
          EOF

      - name: Build deb package
        run: |
          dpkg-deb --build deb zotero_7.0.15-3_arm64.deb

      - name: Upload as artifact
        uses: actions/upload-artifact@v4
        with:
          name: zotero-deb
          path: zotero_7.0.15-3_arm64.deb
